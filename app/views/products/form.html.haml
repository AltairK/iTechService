= auto_header_tag @product
= simple_form_for @product, html: { class: 'form-horizontal' } do |f|
  - if @product.errors.any?
    = @product.errors.full_messages

  %ul.nav.nav-tabs
    %li.active= link_to t('.attributes'), '#attributes', 'data-toggle' => 'tab'
    - if @product.feature_accounting
      %li= link_to Product.human_attribute_name(:items), '#items', 'data-toggle' => 'tab'
    %li= link_to Product.human_attribute_name(:related_products), '#related_products', 'data-toggle' => 'tab'
    %li= link_to Product.human_attribute_name(:related_product_groups), '#related_product_groups', 'data-toggle' => 'tab'

  .tab-content
    #attributes.tab-pane.active

      = f.hidden_field :product_group_id
      = f.full_error :product_group
      = f.input :device_type, as: :device_type if @product.is_equipment
      = f.association :product_category
      = f.input :name
      = f.input :code
      = f.input :warranty_term
      = f.input :quantity_threshold
      = f.input :comment, input_html: {rows: 3}

      - if @product.is_service
        = f.simple_fields_for @product.task || @product.build_task do |ff|
          -#= ff.input :name
          = ff.input :role, collection: User::ROLES, value_method: :to_s, label_method: lambda{|role|t("users.roles.#{role}")}
          = ff.association :location, label_method: :name

      .control-group
        %label.control-label= Product.human_attribute_name :warning_quantities
        .controls
          %table#store_products.form-inline
            = f.simple_fields_for :store_products do |ff|
              = render 'store_product_fields', f: ff
          = link_to_add_fields t('.add_store'), '#store_products', f, :store_products

    - if @product.feature_accounting
      #items.tab-pane
        %table.table.table-condensed
          %thead
            %tr
              %th= Item.human_attribute_name :barcode
              - @product.feature_types.each do |feature_type|
                %th= feature_type.name
          %tbody
            - @product.items.each do |item|
              %tr
                %td= item.barcode_num
                - item.features.each do |feature|
                  %td
                    = hidden_field_tag "item[features_attributes][#{feature.uid}][feature_type_id]", feature.feature_type_id
                    = text_field_tag "item[features_attributes][#{feature.uid}][value]", feature.value

    #related_products.tab-pane
      = f.input :related_product_ids, as: :filterable_association, collection: Product.goods.name_asc, label: false

    #related_product_groups.tab-pane
      = f.input :related_product_group_ids, as: :filterable_association, collection: ProductGroup.except_spare_parts_and_services.name_asc, label: false

  .form-actions
    = submit_button f
