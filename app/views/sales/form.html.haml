#client_form_place.well.well-small
= auto_header_tag @sale
= simple_form_for @sale, html: { class: 'form-horizontal' } do |f|
  - if current_user.superadmin?
    = f.input :date, as: :my_datetime
  = f.input :client_id, as: :client, wrapper_html: { id: 'client_fields' }, no_devices: true, required: true
  = f.association :payment_type
  = f.association :store, collection: Store.for_retail.all
  = hidden_field_tag :price_type_id

  %table#sale_items.enumerable.table.table-condensed.table-hover
    %caption
      %h4= t 'products.index.title'
    %thead
      %tr
        %th.num
        %th.code= Product.human_attribute_name :code
        %th.product= t 'activerecord.models.product'
        %th= Product.human_attribute_name :available
        %th.quantity= SaleItem.human_attribute_name :quantity
        - if can? :view_purchase_price, Product
          %th.purchase_price= Product.human_attribute_name :purchase_price
        %th.price= SaleItem.human_attribute_name :price
        %th.discount= Product.human_attribute_name :discount
        %th.sum= SaleItem.human_attribute_name :sum
        %th.actions

    %tbody= f.fields_for(:sale_items) { |ff| render 'sale_item_fields', f: ff }

    %tfoot
      %tr
        %td{colspan: can?(:view_purchase_price, Product) ? 8 : 7}= t 'total'
        %td.total_sum.number= human_currency @sale.total_sum
        %td

  = link_to_add_product :sale, :sale_items, false

  .form-actions
    = submit_button f