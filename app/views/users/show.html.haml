.page-header
  - if @user.id == current_user.id
    #news
      %h3= link_to t('infos.index.title'), infos_path
      #news_table= render 'infos/table_read'
  - else
    %h2
      = link_back_to_index
      = @user.short_name

%ul.nav.nav-tabs
  %li.active= link_to User.human_attribute_name(:devices), "#devices_tab", 'data-toggle' => 'tab'
  %li= link_to t("users.info"), "#info_tab", 'data-toggle' => 'tab'
  %li= link_to t('users.schedule'), '#schedule_tab', 'data-toggle' => 'tab'
  -#- if can? :manage, Salary
  -#  %li= link_to t('salaries.index.title'), '#salary_tab', 'data-toggle' => 'tab'
  %li= link_to t("users.account"), '#account_tab', 'data-toggle' => 'tab'

.tab-content
  #devices_tab.tab-pane.active
    - if @devices.any?
      %table.table.table-condensed.table-hover
        %thead
          %tr
            %th= t 'devices.received'
            %th= Device.human_attribute_name(:ticket_number)
            %th= t 'activerecord.models.device'
            %th= Device.human_attribute_name(:client)
            %th= Device.human_attribute_name(:location)
            %th
        %tbody
          - @devices.each do |device|
            %tr{class: row_class_for_device(device)}
              %td= t 'moved', user: '', time: distance_of_time_in_words_to_now(device.created_at)
              %td= link_to device.ticket_number, device_path(device)
              %td
                = link_to device.type_name, device_path(device)
                %small= device.serial_number
                %p.device_comment_tooltip{'data-title' => device.comment}
                  %i.icon-comment
              %td= h device.client_presentation
              %td= device.location.try :name
              %td
                .btn-group
                  = link_to_show_small device
                  = link_to_edit_small device# if can? :update, device
                  = link_to_destroy_small device if can? :destroy, device

  #info_tab.tab-pane
    %dl.dl-horizontal

      %dt
      %dd= image_tag @user.photo.medium.url if @user.photo?

      %dt= User.human_attribute_name :fio
      %dd= @user.full_name

      %dt= User.human_attribute_name :birthday
      %dd= @user.birthday.present? ? human_date(@user.birthday) : '-'

      %dt= User.human_attribute_name :hiring_date
      %dd= @user.hiring_date.present? ? human_date(@user.hiring_date) : '-'

      %dt= User.human_attribute_name :prepayment
      %dd= @user.prepayment.present? ? @user.prepayment : '-'

      %dt= User.human_attribute_name :karmas
      %dd
        #user_karmas
          - if can? :create, Karma
            = link_to_add_karma @user, true, class: 'large'
            = link_to_add_karma @user, false, class: 'large'
          #karma_popover_container
          #karma_group_popover_container
          #good_karmas.good.well
            = render @user.karma_groups.unused if @user.karma_groups.any?
            = render @user.karmas.good.unused.ungrouped.created_asc
          = link_to t('karmas.select'), '#', id: 'select_karmas_button', class: 'btn btn-info'
          = form_for :karma_group, url: karma_groups_path, remote: true, html: {id: 'create_karma_group_form', class: 'form-inline'} do |f|
            = f.hidden_field :karma_ids
            .input-append.input-prepend
              = link_to glyph(:remove), '#', class: 'btn', id: 'close_karma_group_form_link'
              = number_field_tag :karma_qty, nil, id: 'karma_group_karma_qty', class: 'input-mini', min: 0
              = f.submit t('karmas.group'), class: 'btn btn-primary'
          #bad_karmas.bad.well= render @user.karmas.bad.created_asc

      %dt= link_to t('bonuses.index.title'), bonuses_user_path(@user), remote: true
      %dd
        #user_bonuses.well

  #schedule_tab.tab-pane

    %dl.dl-horizontal
      %dt
        = User.human_attribute_name :wish
        - if can? :update_wish, @user
          %a#edit_wish_link
            %i.icon-edit
      %dd
        #wish_view= @user.wish
        #wish_edit.hide
          = form_tag update_wish_user_path(@user), remote: true, method: :put, id: 'update_user_wish_form' do
            = text_area_tag 'user_wish', @user.wish, class: 'span7', rows: 5
            %br
            %a#save_user_wish.btn.btn-primary= 'Save'

    %table#schedule_table.table.table-bordered.table-condensed
      %thead
        %tr
          %th
          - ('10'..'20').each do |h|
            %th= h
      %tbody
        - (1..7).each do |day|
          %tr{day: day}
            %td
              %strong= t('date.abbr_day_names')[day-1]
            - (10..20).each do |hour|
              %td{class: schedule_hour_class_for(@user, day, hour), day: day, hour: hour}

    #duty_days
      - DutyDay::KINDS.each do |kind|
        = duty_calendar(kind, Date.current.beginning_of_month, @user)

  #account_tab.tab-pane
    %dl.dl-horizontal
      %dt= User.human_attribute_name :username
      %dd= @user.username

      %dt= User.human_attribute_name :role
      %dd= t "users.roles.#{@user.role}"

      %dt= User.human_attribute_name :department
      %dd= @user.department_name || '-'

      %dt= User.human_attribute_name :location
      %dd= @user.location.try(:name) || '-'

      - if current_user.any_admin?
        %dt= t 'current_sign_in'
        %dd= "#{@user.current_sign_in_ip} at #{l(@user.current_sign_in_at, format: :long_d)}" unless @user.current_sign_in_at.blank?
        %dt= t 'last_sign_in'
        %dd= "#{@user.last_sign_in_ip} at #{l(@user.last_sign_in_at, format: :long_d)}" unless @user.last_sign_in_at.blank?
      - if current_user.developer?
        %dt Authentication Token
        %dd= @user.authentication_token

- if can? :manage, User
  .form-actions
    - if can? :manage, @user
      = link_to_edit @user
    - if can? :manage, Salary
      = link_to (icon_tag(:money) + ' ' + t('salaries.issue')), new_salary_path(user_id: @user.id), class: 'btn'
